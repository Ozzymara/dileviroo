{% extends 'base.html' %}

{% block title %}My_orders
{% endblock title %}

{% block body %}

{% for message in messages %}
<div class="alert alert-success alert-dismissable fade show" role="alert">
    <strong>{{message}}</strong>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endfor %}

<!-- Add the main h1 header here -->
<div class="container text-center my-4">
    <h1>ðŸ“‹ My Orders</h1>
</div>

<!-- Change this to h2 for proper hierarchy -->
<h2 class="text-center mt-4 mb-3">Your Orders</h2>

<!-- ðŸ” Search bar for orders -->
<div class="container col-md-6 mt-3">
    <label for="searchInput" class="visually-hidden">Search your orders</label>
    <input type="text" id="searchInput" class="form-control" placeholder="ðŸ” Search your orders">
    <div id="noOrderResults" class="text-center text-muted mt-3" style="display:none;">No matching orders found ðŸ§¾</div>
</div>

<div style="padding: 15px 50px 15px;">
    {% for table, orders in order_by_table.items %}
    <div style="padding: 15px 5px 15px">
        <hr>
        {% for o in orders %}
        <div class="order-block" style="margin-bottom:25px;">
            <h3>
                Order Time: {{ o.order_time }}
            </h3>
            {% for item_key, item_values in o.items_json.items %}
            <b>{{ item_values.1 }} : {{ item_values.0 }}</b><br><br>
            {% endfor %}
            <b>Total: Â£{{ o.price }}</b>
            <hr>
        </div>
        {% endfor %}
    </div>
    {% endfor %}
</div>

{% endblock body %}

{% block js %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
/* global $ */
    $(function() {
    $('#searchInput').on('input', function() {
        var value = $(this).val().toLowerCase().trim();
        var matchCount = 0;
        $('.order-block').each(function() {
            var text = $(this).text().toLowerCase();
            var matched = value === '' || text.includes(value);
            $(this).toggle(matched);
            if (matched) matchCount++;
        });
        $('#noOrderResults').toggle(matchCount === 0 && value !== '');
    });
});
</script>
{% endblock js %}